<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LOSE IT!!!</title>
    <link rel="stylesheet" href="LOCKIN.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <script src="https://js.paystack.co/v1/inline.js"></script>
    <style>
      /* Active navigation styling */
      .nav-links a.active {
        color: #ff6b35 !important;
        font-weight: 600;
      }
      
      .nav-links a.btn.active {
        background-color: #ff6b35 !important;
        color: white !important;
      }
    </style>
  </head>
  <body>
  
    <!-- Header / Navbar -->
    <header class="site-header">
      <nav class="navbar container">
    <div class="brand">
          <a href="#home" class="brand-link" aria-label="Lose It Home"
            >LOSE <span>IT!!!</span></a
          >
        </div>

        <button class="nav-toggle" aria-label="Toggle menu">
          <span class="bar"></span><span class="bar"></span
          ><span class="bar"></span>
        </button>

        <ul class="nav-links">
          <li><a href="#home" class="nav-link">Home</a></li>
          <li><a href="#about" class="nav-link">About Us</a></li>
          <li><a href="#commitment" class="nav-link">Commitment</a></li>
          <li><a href="#features" class="nav-link">Features</a></li>
          <li><a href="#testimonials" class="nav-link">Testimonials</a></li>
          <li><a href="#faq" class="nav-link">FAQ</a></li>
          <li><a href="#pricing" class=" nav-link">Pricing</a></li>
        </ul>
      </nav>
    </header>


    <!-- HERO -->
    <section id="home" class="hero section has-bg">
      <div class="hero-overlay"></div>
      <div class="container hero-content">
        <h1 class="headline">LOSE WEIGHT WITHOUT LOSING YOUR LIFESTYLE</h1>
        <p class="subtext">
          Built for real life: Flexible, sustainable, and designed to fit your
          lifestyle while delivering real, lasting results.
        </p>
        <!-- Get Started Button -->
       <a href="#enroll" id="getStartedBtn" class="btn btn-lg get-started-btn">Get Started</a>

      </div>
    </section>

    <!-- ===========================
     TRANSFORMATION SECTION
=========================== -->
<section id="transformation" class="section transformation-section section-dark">  <div class="container narrow reveal">    <aside class="hero-box" aria-label="Start Your Transformation">      <h3 class="box-title">Start Your Transformation Now</h3>      <ul class="box-list">        <li>Lose up to 35lbs within the 12-week weight loss program</li>        <li>Nutrition that fits your lifestyle</li>        <li>Mindset and habit support / Accountability</li>        <li>Designed for Beginners and Adaptable for all levels</li>        <li>Home-Ready workouts or Gym Workout Guides following your preferences</li>      </ul>       <!-- Fixed version of the after-line -->      <p class="after-line-static">        AFTER LOSE IT!!!, the only pounds you'll be adding are Â£ not         <span class="red">lbs</span>      </p>    </aside>  </div></section>

    <!-- ===========================
     ABOUT US SECTION
=========================== -->
<section id="about" class="section section-light">
  <div class="container narrow">
    <h2 class="section-title">About Us</h2>
    <p class="section-lead">
      We help working class individuals with busy schedules achieve their weight
      loss and fitness goals through our tried and tested approach to health and
      fitness... <strong>LOSE IT!!!</strong> is built around your lifestyleâ€”so
      you can keep living while you're transforming. With flexible nutrition,
      scalable workouts, and mindset support, you get results that last beyond
      the 12 weeks.
    </p>
  </div>
</section>

    <!-- COMMITMENT --> <section id="commitment" class="section section-dark"> <div class="container narrow"> <div class="countdown-title">Enroll now; <br>Starts 29th November, 2025.</div><br> <div id="countdown" class="countdown"></div> </div> </div> </section>
<!-- FEATURES / PROGRAM BREAKDOWN --> <section id="features" class="section"> <div class="container"> <h2 class="section-title reveal"> What You'll Get â€” Program Breakdown </h2> <div class="cards grid-3"> <div class="card reveal"> <h3>Progress Tracking</h3> <p>Simple Bi-Weekly check-ins and wins.</p> </div> <div class="card reveal delay-1"> <h3>Nutrition Guidelines</h3> <p>Tailored to your preferences.</p> </div> <div class="card reveal delay-2"> <h3>Mindset Tips</h3> <p>Weekly coaching prompts to stay on track.</p> </div> <div class="card reveal"> <h3>Demo Videos</h3> <p>Every exercise clearly explained.</p> </div> <div class="card reveal delay-1"> <h3>Bi-Weekly Plans</h3> <p>5x/week max â€” scalable to your level.</p> </div> <div class="card reveal delay-2"> <h3>Community Support</h3> <p>Motivation and accountability.</p> </div> </div> </div> </section>

    <!-- TESTIMONIALS -->
    <section id="testimonials" class="section section-light">
      <div class="container">
        <h2 class="section-title reveal">What Others Are Saying</h2>
        <div class="cards grid-3">
          <blockquote class="card t-card reveal">
            "lost 7kg to only diet changes, Haven't been able to add workout..."
            <cite>â€” David E.</cite>
          </blockquote>
          <blockquote class="card t-card reveal delay-1">
            "I loved that I could do it all at home, and the meal guidance
            wasn't restrictive."
            <cite>â€” James T.</cite>
          </blockquote>
          <blockquote class="card t-card reveal delay-2">
            "The mindset pieces really helped me stick with it. This program
            isn't just about weight â€” it changed how I see my health."
            <cite>â€” Clara A.</cite>
          </blockquote>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq" class="section">
      <div class="container">
        <h2 class="section-title reveal">Frequently Asked Questions</h2>
        <div class="faq-grid">
          <details class="faq-item reveal">
            <summary>Is this suitable for beginners?</summary>
            <p>
              Yes! LOSE IT !!! is perfect for those just starting out and
              includes progressions for intermediate/advanced levels also.
            </p>
          </details>


          <details class="faq-item reveal delay-1">
            <summary>Why would I ever want to lose weight?</summary>
            <p>
              From a confidence boost to a lighter body and less daily fatigue â€”
              there are lots of benefits you'll notice in your everyday life.
            </p>
          </details>
  
          <details class="faq-item reveal delay-2">
            <summary>What kind of meals will I need to prepare?</summary>
            <p>
              The nutrition side is built around your preferences and
              availability â€” we help you make smarter choices, not restrict your
              favorites.
            </p>
          </details>
 
          <details class="faq-item reveal">
            <summary>Do I need a gym membership?</summary>
            <p>
              Not at all. The entire program is designed to be done at home
              using bodyweight or minimal equipment.
            </p>
          </details>
 <details class="faq-item reveal delay-2">
            <summary>What if I prefer using the gym?</summary>
            <p>Splendid. We've got that covered just the way you like it ;)</p>
          </details>
          <details class="faq-item reveal delay-1">
            <summary>What happens after 12 weeks?</summary>
            <p>
              You'll walk away with better habits, a healthier body, and the
              tools to keep progressing. Optional next-step coaching is also
              available.
            </p>
          </details>

         
        </div>
      </div>
    </section>

    <!-- PRICING SECTION -->
    <section id="pricing" class="section section-dark">
      <div class="container narrow">
        <h2 class="section-title reveal">Simple, One-Time Payment</h2>

        <p class="price reveal">
          <span class="old-price"> $50</span> <span class="new-price"> $30</span> <br />
        </p>

        <p class="muted reveal">
         âš  Enroll before the deadline to secure your exclusive discount, after which prices return to full rate and stays open for ONLY one week.
No subscriptions. No hidden fees. Just lasting results...
        </p>

        <div class="pricing-cards">
          <div class="card reveal delay-1">
               <br />
            <h3>Personalised Workout Plan</h3>
         
           
            <p class="price">+ Extra Cost: $10 per Month</p>
          </div>
        </div>
   <br />
        <p class="muted reveal delay-2">
          After payment, you'll be added to our exclusive community for
          support, accountability, and motivation.
        </p>

        <div
          id="countdown-bottom"
          class="countdown in-dark reveal"
          aria-live="polite"
        ></div>

        <button
          id="enrollBtn"
          class="btn btn-lg reveal delay-1"
          type="button"
          aria-label="Enroll Now"
        >
          Enroll Now
        </button>
        
      </div>
    </section>

    <!-- ===========================
     ENROLL NOW MODAL
=========================== -->
<div id="enrollModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" id="closeModal">&times;</span>
    <h2>Enroll Now</h2>

    <form id="enrollForm">
      <input type="text" name="name" placeholder="Full Name" required />
      <input type="email" name="email" placeholder="Email Address" required />
      <input type="tel" name="phone" placeholder="Phone Number" required />

      <!-- Current Weight -->
      <div class="weight-input-group">
        <input
          type="number"
          name="weight"
          id="weight"
          placeholder="Current Weight"
          required
          min="1"
          step="0.1"
        />
        <select name="weightUnit" id="weightUnit" required>
          <option value="kg">kg</option>
          <option value="lbs">lbs</option>
        </select>
      </div>

      <!-- Goal Weight -->
      <div class="weight-input-group">
        <input
          type="number"
          name="goal"
          id="goal"
          placeholder="Goal Weight"
          required
          min="1"
          step="0.1"
        />
        <select name="goalUnit" id="goalUnit" required>
          <option value="kg">kg</option>
          <option value="lbs">lbs</option>
        </select>
      </div>

          <select name="plan" required>
            <option value="">Preferred Workout Type</option>
            <option value="home">Home Workouts</option>
            <option value="gym">Gym Workouts</option>
          </select>

          <!-- Personalized Workout Plan Option -->
          <div class="extra-option">
            <label class="checkbox-label">
              <input
                type="checkbox"
                name="personalized_plan"
                id="personalizedPlan"
                value="yes"
              />
              <span class="checkmark"></span>
              <strong>Add Personalized Workout Plan (+$10 per month) <span style="color:red">*</span></strong>
            </label>
            <div id="personalizedOptions" style="display: none; margin-top: 10px">
              <select name="personalized_months" id="personalizedMonths">
                <option value="">NILL</option>
                <option value="1">1 Month ($10)</option>
                <option value="2">2 Months ($20)</option>
                <option value="3">3 Months ($30)</option>
              </select>
              <small style="color: #666; display: block; margin-top: 5px;">Select NILL if you don't want personalized plan</small>
            </div>
          </div>

          <!-- Currency Selection -->
          <select name="currency" id="currencySelect" required>
            <option value="">Select Payment Method</option>
            <option value="NGN">Recommended for Nigeria</option>
          
            <option value="manual">ERROR (Contact Us)</option>
          </select>

          <!-- Payment Summary -->
          <div
            id="paymentSummary"
            class="payment-summary"
            style="display: none"
          >
            <h4>Payment Summary</h4>
            <div class="summary-line">
              <span>Program Fee:</span>
              <span id="baseAmountDisplay">$30</span>
            </div>
            <div
              class="summary-line"
              id="personalizedSummary"
              style="display: none"
            >
              <span>Personalized Plan:</span>
              <span id="personalizedAmount">$0</span>
            </div>
            <div class="summary-total">
              <span>Total Amount:</span>
              <span id="totalAmount">$30</span>
            </div>
          </div>

          <div id="paystackSection" style="display: none">
            <p class="muted">
              Click the button below to proceed with secure payment via Paystack
            </p>
            <button type="button" id="payWithPaystack" class="btn btn-lg">
              Pay <span id="paystackAmount">$30</span> with Paystack
            </button>
          </div>

          <div id="manualPaymentSection" style="display: none">
            <p class="muted">
              For any error, please contact us directly at
             jeasthenics@gmail.com
            </p>
            <button type="button" id="submitManual">
              Submit Enrollment (Manual Payment)
            </button>
          </div>
        </form>

        <div id="successMessage" class="success-message" style="display: none">
          âœ… Thank you! Your enrollment has been submitted.
        </div>
      </div>
    </div>

    <!-- PAYMENT SUCCESS MODAL -->
    <div id="paymentSuccessModal" class="modal">
      <div class="modal-content">
        <h2>Payment Successful! ðŸŽ‰</h2>
        <p>
          Thank you for enrolling in LOSE IT!!! Your payment was successful.
        </p>
        <p id="successDetails"></p>
        <p>
          You will receive a confirmation email shortly and will be added to our
          exclusive WhatsApp community within 24 hours.
        </p>
        <button id="closeSuccessModal" class="btn btn-lg">Continue</button>
      </div>
    </div>

    <!-- FOOTER -->
    <footer class="site-footer">
      <div class="container footer-inner">
        <div class="collab">
          <p>In collaboration with</p>
          <img src="BW.jpg" alt="BWfit Logo" class="collab-logo" />
        </div>
        <p>
          Â© <span id="year"></span> LOSE IT!!!. All rights reserved.<br />Built by
          kmbbassey@gmail.com<br />
        </p>
        <a class="to-top" href="#home" aria-label="Back to top">â†‘</a>
      </div>
    </footer>

    <script>
      // ===== Mobile nav toggle =====
      const navToggle = document.querySelector(".nav-toggle");
      const navLinks = document.querySelector(".nav-links");
      const body = document.body;

      if (navToggle && navLinks) {
        navToggle.addEventListener("click", () => {
          const isOpen = navLinks.classList.toggle("open");
          navToggle.classList.toggle("open");
          
          // Prevent body scroll when menu is open
          if (isOpen) {
            body.style.overflow = 'hidden';
          } else {
            body.style.overflow = '';
          }
        });

        document.querySelectorAll(".nav-links a").forEach((a) => {
          a.addEventListener("click", () => {
            navLinks.classList.remove("open");
            navToggle.classList.remove("open");
            body.style.overflow = ''; // Restore scroll
          });
        });
      }

      // ===== Active Navigation Highlighting =====
      function setActiveNav() {
        const sections = document.querySelectorAll('section[id]');
        const navLinks = document.querySelectorAll('.nav-link');
        
        let currentSection = '';
        const scrollPos = window.scrollY + 100;

        sections.forEach(section => {
          const sectionTop = section.offsetTop;
          const sectionHeight = section.offsetHeight;
          
          if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
            currentSection = section.getAttribute('id');
          }
        });

        navLinks.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('href') === `#${currentSection}`) {
            link.classList.add('active');
          }
        });
      }

      // Set active nav on scroll and load
      window.addEventListener('scroll', setActiveNav);
      window.addEventListener('load', setActiveNav);

      // Smooth scrolling with active nav update
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
          const target = document.querySelector(this.getAttribute("href"));
          if (!target) return;
          e.preventDefault();
          target.scrollIntoView({ behavior: "smooth", block: "start" });
          
          // Update active nav after scroll
          setTimeout(setActiveNav, 100);
        });
      });

      // ===== Countdown timer =====
      const targetDate = new Date("November 29, 2025 23:59:59").getTime();

      function runCountdown(id) {
        const el = document.getElementById(id);
        if (!el) return;

        function tick() {
          const now = Date.now();
          const dist = targetDate - now;

          if (dist <= 0) {
            el.textContent = "ðŸŽ‰ Enrollment window has ended";
            return;
          }
          const d = Math.floor(dist / (1000 * 60 * 60 * 24));
          const h = Math.floor(
            (dist % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
          );
          const m = Math.floor((dist % (1000 * 60 * 60)) / (1000 * 60));
          const s = Math.floor((dist % (1000 * 60)) / 1000);

          el.innerHTML = `
            <span class="cd">${d}<small>d</small></span>
            <span class="cd">${h}<small>h</small></span>
            <span class="cd">${m}<small>m</small></span>
            <span class="cd">${s}<small>s</small></span>
          `;
        }
        tick();
        setInterval(tick, 1000);
      }

      // Initialize countdowns
      if (document.getElementById("countdown")) {
        runCountdown("countdown");
      }
      if (document.getElementById("countdown-bottom")) {
        runCountdown("countdown-bottom");
      }

      // ===== Scroll reveal animations =====
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) entry.target.classList.add("in");
          });
        },
        { threshold: 0.12 }
      );

      document
        .querySelectorAll(".reveal")
        .forEach((el) => observer.observe(el));

      // ===== Year in footer =====
      const yearElement = document.getElementById("year");
      if (yearElement) {
        yearElement.textContent = new Date().getFullYear();
      }

      // ===== Enhanced Phone Number Validation =====
      function validatePhoneNumber(phone) {
        // Remove all non-digit characters except + (for international numbers)
        const cleanPhone = phone.replace(/[^\d+]/g, '');
        
        // Check if it starts with + (international) or is local
        if (cleanPhone.startsWith('+')) {
          // International number: + followed by 10-15 digits
          const digitsOnly = cleanPhone.substring(1);
          if (digitsOnly.length < 10 || digitsOnly.length > 15) {
            return { isValid: false, message: "International number should be 10-15 digits after +" };
          }
          if (!/^\d+$/.test(digitsOnly)) {
            return { isValid: false, message: "Invalid international number format" };
          }
        } else {
          // Local number: 10-11 digits
          if (cleanPhone.length < 10 || cleanPhone.length > 11) {
            return { isValid: false, message: "Phone number should be 10-11 digits" };
          }
          if (!/^\d+$/.test(cleanPhone)) {
            return { isValid: false, message: "Invalid phone number format" };
          }
        }
        
        return { isValid: true, message: "Valid phone number" };
      }

      // ===== Enhanced Email Validation =====
      function validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          return { isValid: false, message: "Please enter a valid email address" };
        }
        
        // Additional check for common email providers
        const commonDomains = ['gmail.com', 'yahoo.com', 'hotmail.com', 'outlook.com', 'icloud.com'];
        const domain = email.split('@')[1];
        if (!commonDomains.includes(domain.toLowerCase())) {
          // Still valid but warn about uncommon domains
          console.log("Uncommon email domain:", domain);
        }
        
        return { isValid: true, message: "Valid email address" };
      }

      // ===== Enhanced Form Validation Functions =====
      function validateAllFields() {
        const name = document.getElementById("enrollForm").name.value.trim();
        const email = document.getElementById("enrollForm").email.value.trim();
        const phone = document.getElementById("enrollForm").phone.value.trim();
        const currentWeight = document.getElementById("weight").value;
        const goalWeight = document.getElementById("goal").value;
        const currentUnit = document.getElementById("weightUnit").value;
        const goalUnit = document.getElementById("goalUnit").value;
        const plan = document.getElementById("enrollForm").plan.value;
        const currency = document.getElementById("currencySelect").value;
        const personalizedPlan = document.getElementById("personalizedPlan").checked;
        const personalizedMonths = document.getElementById("personalizedMonths").value;

        // Check required fields
        if (!name || !email || !phone || !currentWeight || !goalWeight || !plan || !currency) {
          return { isValid: false, message: "Please fill in all required fields" };
        }

        // Validate email
        const emailValidation = validateEmail(email);
        if (!emailValidation.isValid) {
          return { isValid: false, message: emailValidation.message };
        }

        // Validate phone number
        const phoneValidation = validatePhoneNumber(phone);
        if (!phoneValidation.isValid) {
          return { isValid: false, message: phoneValidation.message };
        }

        // Validate weights are numbers
        if (isNaN(currentWeight) || isNaN(goalWeight)) {
          return { isValid: false, message: "Weight must be a valid number" };
        }

        // Validate weights are positive
        if (parseFloat(currentWeight) <= 0 || parseFloat(goalWeight) <= 0) {
          return { isValid: false, message: "Weight must be greater than 0" };
        }

        // Convert weights to common unit for comparison
        let currentWeightKg = parseFloat(currentWeight);
        let goalWeightKg = parseFloat(goalWeight);

        if (currentUnit === 'lbs') {
          currentWeightKg = currentWeightKg * 0.453592;
        }
        if (goalUnit === 'lbs') {
          goalWeightKg = goalWeightKg * 0.453592;
        }

        // Validate goal weight is less than current weight
        if (goalWeightKg >= currentWeightKg) {
          return { isValid: false, message: "Goal weight must be less than current weight" };
        }

        // FIXED: Allow proceeding even if NILL is selected for personalized plan
        // Only validate if personalized plan is checked AND user selected a duration
        if (personalizedPlan && personalizedMonths && personalizedMonths !== "" && personalizedMonths !== "NILL") {
          // If they selected a duration (not NILL), validate it's a valid number
          const months = parseInt(personalizedMonths);
          if (isNaN(months) || months < 1) {
            return { isValid: false, message: "Please select a valid duration for personalized workout plan" };
          }
        }

        return { isValid: true, message: "All fields are valid" };
      }

      // ===== Modal (Enroll Now) =====
      const modal = document.getElementById("enrollModal");
      const openBtn = document.getElementById("enrollBtn");
      const closeBtn = document.getElementById("closeModal");
      const form = document.getElementById("enrollForm");
      const successMessage = document.getElementById("successMessage");
      const paymentMethod = document.getElementById("currencySelect");
      const paystackSection = document.getElementById("paystackSection");
      const manualPaymentSection = document.getElementById("manualPaymentSection");
      const personalizedPlan = document.getElementById("personalizedPlan");
      const personalizedOptions = document.getElementById("personalizedOptions");
      const personalizedMonths = document.getElementById("personalizedMonths");
      const paymentSummary = document.getElementById("paymentSummary");

      // Helper functions for showing errors
      function showFieldError(field, message) {
        // Remove any existing error message
        clearFieldError(field);
        
        // Create error message element
        const errorElement = document.createElement('div');
        errorElement.className = 'field-error';
        errorElement.style.color = '#ef4444';
        errorElement.style.fontSize = '0.8rem';
        errorElement.style.marginTop = '4px';
        errorElement.textContent = message;
        
        // Insert after the field
        field.parentNode.insertBefore(errorElement, field.nextSibling);
      }

      function clearFieldError(field) {
        const existingError = field.parentNode.querySelector('.field-error');
        if (existingError) {
          existingError.remove();
        }
      }

      // Real-time validation for email
      const emailInput = document.getElementById("enrollForm").email;
      if (emailInput) {
        emailInput.addEventListener("blur", function() {
          const emailValue = this.value.trim();
          if (emailValue) {
            const validation = validateEmail(emailValue);
            if (!validation.isValid) {
              this.style.borderColor = "#ef4444";
              showFieldError(this, validation.message);
            } else {
              this.style.borderColor = "#22c55e";
              clearFieldError(this);
            }
          }
        });
      }

      // Real-time validation for phone number
      const phoneInput = document.getElementById("enrollForm").phone;
      if (phoneInput) {
        phoneInput.addEventListener("blur", function() {
          const phoneValue = this.value.trim();
          if (phoneValue) {
            const validation = validatePhoneNumber(phoneValue);
            if (!validation.isValid) {
              this.style.borderColor = "#ef4444";
              showFieldError(this, validation.message);
            } else {
              this.style.borderColor = "#22c55e";
              clearFieldError(this);
            }
          }
        });
      }

      // Real-time validation for weight comparison
      function validateWeights() {
        const currentWeight = document.getElementById("weight").value;
        const goalWeight = document.getElementById("goal").value;
        const currentUnit = document.getElementById("weightUnit").value;
        const goalUnit = document.getElementById("goalUnit").value;

        if (currentWeight && goalWeight && !isNaN(currentWeight) && !isNaN(goalWeight)) {
          let currentWeightKg = parseFloat(currentWeight);
          let goalWeightKg = parseFloat(goalWeight);

          if (currentUnit === 'lbs') currentWeightKg *= 0.453592;
          if (goalUnit === 'lbs') goalWeightKg *= 0.453592;

          const goalInput = document.getElementById("goal");
          if (goalWeightKg >= currentWeightKg) {
            goalInput.style.borderColor = "#ef4444";
            showFieldError(goalInput, "Goal weight must be less than current weight");
            return false;
          } else {
            goalInput.style.borderColor = "#22c55e";
            clearFieldError(goalInput);
            return true;
          }
        }
        return true;
      }

      // Add event listeners for weight validation
      document.getElementById("weight").addEventListener("blur", validateWeights);
      document.getElementById("goal").addEventListener("blur", validateWeights);
      document.getElementById("weightUnit").addEventListener("change", validateWeights);
      document.getElementById("goalUnit").addEventListener("change", validateWeights);

      // Personalized plan toggle
      if (personalizedPlan) {
        personalizedPlan.addEventListener("change", function () {
          if (personalizedOptions) {
            personalizedOptions.style.display = this.checked ? "block" : "none";
          }
          updatePaymentSummary();
        });
      }

      // Months selection change
      if (personalizedMonths) {
        personalizedMonths.addEventListener("change", function() {
          updatePaymentSummary();
        });
      }

      // Currency selection handler - FIXED
      if (paymentMethod) {
        paymentMethod.addEventListener("change", function () {
          const currency = this.value;
          
          // Reset payment sections
          if (paystackSection) {
            paystackSection.style.display = "none";
          }
          if (manualPaymentSection) {
            manualPaymentSection.style.display = "none";
          }
          if (paymentSummary) {
            paymentSummary.style.display = "none";
          }
          
          // Show appropriate sections based on selection
          if (currency === "NGN" || currency === "USD") {
            if (paystackSection) paystackSection.style.display = "block";
            if (paymentSummary) paymentSummary.style.display = "block";
          } else if (currency === "manual") {
            if (manualPaymentSection) manualPaymentSection.style.display = "block";
            if (paymentSummary) paymentSummary.style.display = "block";
          }
          
          updatePaymentSummary();
        });
      }

      // Update payment summary - FIXED currency switching
      function updatePaymentSummary() {
        const currencySelect = document.getElementById("currencySelect");
        if (!currencySelect) return;

        const currency = currencySelect.value;
        
        // Set correct base amounts and rates
        let baseAmount, personalizedRate;
        
        if (currency === "USD") {
          baseAmount = 30;
          personalizedRate = 10;
        } else {
          // For both NGN and manual error option, use Naira pricing
          baseAmount = 45000;
          personalizedRate = 15000;
        }

        let personalizedAmount = 0;

        if (personalizedPlan && personalizedPlan.checked) {
          const monthsValue = personalizedMonths ? personalizedMonths.value : "";
          
          // FIXED: Only charge if they selected a valid duration (not empty or "NILL")
          if (monthsValue && monthsValue !== "" && monthsValue !== "NILL") {
            const months = parseInt(monthsValue);
            personalizedAmount = isNaN(months) ? 0 : months * personalizedRate;
          }
        }

        const totalAmount = baseAmount + personalizedAmount;

        // Format amount display
        const formatAmount = (amount, curr) => {
          if (curr === "NGN" || curr === "manual") {
            return `â‚¦${amount.toLocaleString()}`;
          } else {
            return `$${amount}`;
          }
        };

        // Update summary display
        if (document.getElementById("personalizedSummary")) {
          const shouldShowPersonalized = personalizedPlan && personalizedPlan.checked && personalizedAmount > 0;
          document.getElementById("personalizedSummary").style.display = shouldShowPersonalized ? "flex" : "none";
        }
        if (document.getElementById("personalizedAmount")) {
          document.getElementById("personalizedAmount").textContent = formatAmount(personalizedAmount, currency);
        }
        if (document.getElementById("baseAmountDisplay")) {
          document.getElementById("baseAmountDisplay").textContent = formatAmount(baseAmount, currency);
        }
        if (document.getElementById("totalAmount")) {
          document.getElementById("totalAmount").textContent = formatAmount(totalAmount, currency);
        }
        if (document.getElementById("paystackAmount")) {
          document.getElementById("paystackAmount").textContent = formatAmount(totalAmount, currency);
        }
      }

      // ===== PAYSTACK PAYMENT INTEGRATION =====
      const payWithPaystackBtn = document.getElementById("payWithPaystack");
      if (payWithPaystackBtn) {
        payWithPaystackBtn.addEventListener("click", function(e) {
          e.preventDefault();
          
          const validation = validateAllFields();
          if (!validation.isValid) {
            alert(validation.message);
            return;
          }

          // Get form data
          const name = form.name.value.trim();
          const email = form.email.value.trim();
          const phone = form.phone.value.trim();
          const currency = document.getElementById("currencySelect").value;
          
          // Calculate amounts - FIXED: Use correct pricing based on currency
          let baseAmount, personalizedRate;
          
          if (currency === "USD") {
            baseAmount = 30;
            personalizedRate = 10;
          } else {
            baseAmount = 45000;
            personalizedRate = 15000;
          }
          
          let personalizedAmount = 0;
          let personalizedMonthsValue = 0;

          if (personalizedPlan && personalizedPlan.checked) {
            const monthsValue = personalizedMonths.value;
            if (monthsValue && monthsValue !== "" && monthsValue !== "NILL") {
              personalizedMonthsValue = parseInt(monthsValue);
              personalizedAmount = personalizedMonthsValue * personalizedRate;
            }
          }

          const totalAmount = baseAmount + personalizedAmount;
          
          // FIXED: Convert to smallest currency unit for Paystack
          const amountInSmallestUnit = totalAmount * 100;
          // For NGN: â‚¦45,000 â†’ 45,000 * 100 = 4,500,000 kobo (correct!)
          // For USD: $30 â†’ 30 * 100 = 3000 cents (correct!)

          // Prepare payment data
          const paymentData = {
            key: 'pk_live_ab74bff902b672e6e983b08fe3da6c3042baa2ca',
            email: email,
            amount: amountInSmallestUnit, // FIXED: Now using correct amount
            currency: currency,
            ref: 'LOSEIT_' + Math.floor((Math.random() * 1000000000) + 1),
            metadata: {
              custom_fields: [
                {
                  display_name: "Full Name",
                  variable_name: "full_name",
                  value: name
                },
                {
                  display_name: "Phone Number",
                  variable_name: "phone_number",
                  value: phone
                },
                {
                  display_name: "Program",
                  variable_name: "program",
                  value: "LOSE IT 12-Week Weight Loss"
                },
                {
                  display_name: "Personalized Plan",
                  variable_name: "personalized_plan",
                  value: personalizedPlan.checked ? "Yes" : "No"
                },
                {
                  display_name: "Personalized Months",
                  variable_name: "personalized_months",
                  value: personalizedMonthsValue.toString()
                }
              ]
            },
            callback: function(response) {
              // Payment successful
              console.log("Payment successful:", response);
              
              // Save enrollment data
              const enrollmentData = {
                name: name,
                email: email,
                phone: phone,
                weight: form.weight.value,
                goal: form.goal.value,
                plan: form.plan.value,
                personalized_plan: personalizedPlan.checked ? "yes" : "no",
                personalized_months: personalizedMonthsValue.toString(),
                base_amount: baseAmount,
                personalized_amount: personalizedAmount,
                total_amount: totalAmount,
                currency: currency,
                payment_method: "paystack",
                payment_status: "completed",
                payment_reference: response.reference,
                submittedAt: new Date().toISOString(),
                program: "LOSE IT 12-Week Weight Loss",
              };

              try {
                const enrollments = JSON.parse(localStorage.getItem("enrollments")) || [];
                enrollments.push(enrollmentData);
                localStorage.setItem("enrollments", JSON.stringify(enrollments));

                // Show success modal
                const successModal = document.getElementById("paymentSuccessModal");
                const successDetails = document.getElementById("successDetails");
                
                if (successDetails) {
                  successDetails.innerHTML = `
                    <strong>Payment Details:</strong><br>
                    Amount: ${currency === "NGN" ? 'â‚¦' : '$'}${totalAmount}<br>
                    Reference: ${response.reference}<br>
                    Program: LOSE IT 12-Week Weight Loss
                  `;
                }
                
                if (successModal) {
                  successModal.style.display = "flex";
                }
                
                // Close enrollment modal
                if (modal) {
                  modal.style.display = "none";
                }
                
                // Reset form
                if (form) form.reset();
                if (personalizedOptions) personalizedOptions.style.display = "none";
                if (personalizedPlan) personalizedPlan.checked = false;
                
              } catch (error) {
                console.error("Error saving enrollment:", error);
                alert("Payment successful but there was an error saving your enrollment details. Please contact support.");
              }
            },
            onClose: function() {
              // Payment modal closed
              console.log("Payment modal closed");
              alert("Payment was not completed. Please try again.");
            }
          };

          // Initialize Paystack payment
          try {
            const handler = PaystackPop.setup(paymentData);
            handler.openIframe();
          } catch (error) {
            console.error("Paystack error:", error);
            alert("Error initializing payment. Please try again or contact support.");
          }
        });
      }

      // Enhanced manual payment with validation
      const submitManual = document.getElementById("submitManual");
      if (submitManual) {
        submitManual.addEventListener("click", function (e) {
          e.preventDefault();

          const validation = validateAllFields();
          if (!validation.isValid) {
            alert(validation.message);
            return;
          }

          if (!form) return;

          const name = form.name.value.trim();
          const email = form.email.value.trim();
          const phone = form.phone.value.trim();
          const currency = document.getElementById("currencySelect").value;

          // Calculate amounts - FIXED: Use correct pricing
          let baseAmount, personalizedRate;
          
          if (currency === "USD") {
            baseAmount = 30;
            personalizedRate = 10;
          } else {
            baseAmount = 45000;
            personalizedRate = 15000;
          }
          
          let personalizedAmount = 0;
          let personalizedMonthsValue = 0;

          if (document.getElementById("personalizedPlan").checked) {
            personalizedMonthsValue = parseInt(
              document.getElementById("personalizedMonths").value
            );
            personalizedAmount = personalizedMonthsValue * personalizedRate;
          }

          const totalAmount = baseAmount + personalizedAmount;

          // Save manual payment enrollment
          try {
            const enrollmentData = {
              name: name,
              email: email,
              phone: phone,
              weight: form.weight.value,
              goal: form.goal.value,
              plan: form.plan.value,
              personalized_plan: document.getElementById("personalizedPlan")
                .checked
                ? "yes"
                : "no",
              personalized_months: personalizedMonthsValue.toString(),
              base_amount: baseAmount,
              personalized_amount: personalizedAmount,
              total_amount: totalAmount,
              currency: currency,
              payment_method: "manual",
              payment_status: "pending",
              submittedAt: new Date().toISOString(),
              program: "LOSE IT 12-Week Weight Loss",
            };

            const enrollments =
              JSON.parse(localStorage.getItem("enrollments")) || [];
            enrollments.push(enrollmentData);
            localStorage.setItem("enrollments", JSON.stringify(enrollments));

            // Show success message
            if (successMessage) {
              successMessage.style.display = "block";
            }
            if (form) form.reset();
            if (personalizedOptions) personalizedOptions.style.display = "none";
            if (personalizedPlan) personalizedPlan.checked = false;

            // Auto-close after 3 seconds
            setTimeout(() => {
              if (successMessage) successMessage.style.display = "none";
              if (modal) modal.style.display = "none";
            }, 3000);
          } catch (error) {
            console.error("Error saving manual enrollment:", error);
            alert(
              "There was an error submitting your enrollment. Please try again."
            );
          }
        });
      }

      // Reset success message each time modal opens
      if (openBtn && modal) {
        openBtn.onclick = () => {
          if (successMessage) successMessage.style.display = "none";
          modal.style.display = "flex";
          if (form) form.reset();
          if (paystackSection) paystackSection.style.display = "none";
          if (manualPaymentSection) manualPaymentSection.style.display = "none";
          if (paymentSummary) paymentSummary.style.display = "none";
          if (personalizedOptions) personalizedOptions.style.display = "none";
          if (personalizedPlan) personalizedPlan.checked = false;
        };
      }

      // Close modal handlers
      if (closeBtn && modal) {
        closeBtn.onclick = () => (modal.style.display = "none");
      }

      if (modal) {
        window.onclick = (e) => {
          if (e.target === modal) modal.style.display = "none";
        };
      }

      // Close success modal
      const closeSuccessModal = document.getElementById("closeSuccessModal");
      const paymentSuccessModal = document.getElementById("paymentSuccessModal");

      if (closeSuccessModal && paymentSuccessModal) {
        closeSuccessModal.onclick = () => {
          paymentSuccessModal.style.display = "none";
        };
      }

      // === "Get Started" button opens the enroll modal ===
      const getStartedBtn = document.getElementById("getStartedBtn");
      if (getStartedBtn && modal) {
        getStartedBtn.addEventListener("click", (e) => {
          e.preventDefault();
          modal.style.display = "flex";
          if (successMessage) successMessage.style.display = "none";
          if (form) form.reset();
          if (paystackSection) paystackSection.style.display = "none";
          if (manualPaymentSection) manualPaymentSection.style.display = "none";
          if (paymentSummary) paymentSummary.style.display = "none";
          if (personalizedOptions) personalizedOptions.style.display = "none";
          if (personalizedPlan) personalizedPlan.checked = false;
        });
      }
    </script>
  </body>
</html>